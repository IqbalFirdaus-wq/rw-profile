<% /* keamanan.ejs â€“ daftar data keamanan per RW */ %>

<div class="d-flex justify-content-between mb-3">
  <h1 class="h4">
    Daftar Keamanan 
  </h1>

  <div class="d-flex gap-2">
    <!-- ðŸ”½ Dropdown Filter RW -->
    <form method="get" action="/keamanan" class="d-flex align-items-center">
      <div class="input-group" style="max-width: 250px;">
        <label class="input-group-text" for="rwSelect">RW</label>
        <select name="rw" id="rw" 
        onchange="if(this.value) location.href='/keamanan/'+this.value; else location.href='/keamanan'">
  <option value="">Semua RW</option>
  <% rwList.forEach(rw => { %>
    <option value="<%= rw.id %>"
      <%= rw_id && String(rw.id) === String(rw_id) ? 'selected' : '' %>>
      RW <%= rw.kode_rw %> - <%= rw.nama_rw %>
    </option>
  <% }) %>
</select>
      </div>
    </form>

    <!-- Tombol Export Excel dan Tambah -->
    <a href="/keamanan/<%= rw_id ? rw_id : '' %>/export/excel"
       class="btn btn-success btn-sm">Export Excel</a>
    <a href="/keamanan/add"
       class="btn btn-primary btn-sm">+ Tambah Data</a>
  </div>
</div>

<table class="table table-striped table-bordered bg-white shadow-sm">
  <thead class="table-success">
    <tr>
      <!-- Kolom RW -->
      <th>
        <a href="?sort=kode_rw&order=<%= sort==='kode_rw' && order==='ASC' ? 'DESC':'ASC' %>">
          RW
        </a>
      </th>

      <!-- Kolom Nama RW -->
      <th>
          Nama RW
      </th>

      <th>Pos Unit</th>
      <th>Pos Baik</th>
      <th>Pos Rusak</th>
      <th>Jumlah Linmas</th>
      <th>Jumlah Satpam</th>
      <th>Jumlah CCTV</th>
      <th>CCTV Baik</th>
      <th>CCTV Rusak</th>
      <th>Titik Rawan</th>
      <th>Jumlah APAR</th>
      <th>Sprinkle</th>
      <th>Sumber Air</th>
      <th>Aksi</th>
    </tr>
  </thead>

  <tbody>
    <% if (keamanan.length > 0) { %>
      <% keamanan.forEach(k => { %>
        <tr>
          <td><%= k.kode_rw %></td>
          <td><%= k.nama_rw %></td>
          <td><%= k.pos_keamanan_unit %></td>
          <td><%= k.pos_keamanan_baik %></td>
          <td><%= k.pos_keamanan_rusak %></td>
          <td><%= k.jumlah_linmas %></td>
          <td><%= k.jumlah_satpam %></td>
          <td><%= k.jumlah_cctv %></td>
          <td><%= k.cctv_baik %></td>
          <td><%= k.cctv_rusak %></td>
          <td><%= k.titik_rawan %></td>
          <td><%= k.jumlah_apar %></td>
          <td><%= k.jumlah_sprinkle %></td>
          <td><%= k.jumlah_sumber_air %></td>
          <td>
            <a href="/keamanan/<%= k.rw_id %>/edit/<%= k.id %>"
               class="btn btn-warning btn-sm">Edit</a>
          
            <form action="/keamanan/<%= k.rw_id %>/delete/<%= k.id %>" 
                  method="post" 
                  style="display:inline"
                  onsubmit="return confirm('Yakin hapus data ini?')">
              <button type="submit" class="btn btn-danger btn-sm">Hapus</button>
            </form>
          </td>          
        </tr>
      <% }) %>
    <% } else { %>
      <tr>
        <td colspan="7" style="text-align:center;">Tidak ada data keamanan</td>
      </tr>
    <% } %>
  </tbody>
</table>