<% /* views/organisasi/organisasi.ejs â€“ daftar organisasi */ %>

<div class="d-flex justify-content-between mb-3">
  <h1 class="h4">
    Daftar Organisasi
  </h1>
  <div class="d-flex gap-2">
    <a href="/organisasi/<%= rw_id || '' %>/export/excel?sort=<%= sort %>&order=<%= order %>"
       class="btn btn-success btn-sm">Export Excel</a>
       <a href="/Organisasi/add"
       class="btn btn-primary btn-sm">+ Tambah Organisasi</a>      
  </div>
</div>

<!-- ðŸ”½ Dropdown Filter RW -->
<form class="mb-3">
  <div class="input-group" style="max-width: 260px;">
    <label class="input-group-text">RW</label>
    <select id="rwSelect" class="form-select"
            onchange="location.href = this.value ? '/organisasi/' + this.value : '/organisasi';">
      <option value="" <%= !rw_id ? 'selected' : '' %>>Semua RW</option>
      <% allRw.forEach(rw => { %>
        <option value="<%= rw.id %>" <%= rw_id == rw.id ? 'selected' : '' %>>
          RW <%= rw.kode_rw %>
        </option>
      <% }) %>
    </select>
  </div>
</form>


<div class="table-card">
  <table class="table table-striped table-bordered bg-white shadow-sm">
    <thead class="table-success">
      <tr>
        <!-- RW -->
        <th>
          <a href="?rw=<%= rw_id || '' %>&sort=kode_rw&order=<%= sort==='kode_rw' && order==='ASC' ? 'DESC':'ASC' %>">
            RW
            <% if (sort==='kode_rw'){ %><%= order==='ASC'?'â–²':'â–¼' %><% } %>
          </a>
        </th>

        <!-- Tipe -->
        <th>
          
            Tipe
            
        </th>

        <!-- Nama -->
        <th>
          
            Nama
            
        </th>

        <th>Unit</th>
        <th>Orang</th>
        <th>Lokasi</th>
        <th>Keterangan</th>
        <th>Aksi</th>
      </tr>
    </thead>

    <tbody>
      <% if (orgs && orgs.length) { %>
        <% orgs.forEach(o => { %>
          <tr>
            <td><%= o.kode_rw %></td>
            <td><%= o.tipe %></td>
            <td><%= o.nama %></td>
            <td><%= o.jumlah_unit %></td>
            <td><%= o.jumlah_orang %></td>
            <td><%= o.lokasi %></td>
            <td><%= o.keterangan %></td>
            <td>
              <a href="/organisasi/<%= o.rw_id %>/edit/<%= o.id %>" class="btn btn-warning btn-sm">Edit</a>
              <form action="/organisasi/<%= o.rw_id %>/delete/<%= o.id %>" method="post" class="d-inline"
                    onsubmit="return confirm('Hapus organisasi ini?');">
                <button class="btn btn-danger btn-sm">Hapus</button>
              </form>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr><td colspan="8" class="text-center text-muted">Tidak ada data organisasi</td></tr>
      <% } %>
    </tbody>
  </table>
</div>
