<% /* views/penduduk/penduduk.ejs */ %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4">Daftar Penduduk</h1>

  <div class="d-flex gap-2">
    <!-- Filter RW -->
    <form method="get" action="/penduduk" class="d-flex align-items-center">
      <div class="input-group" style="max-width: 250px;">
        <label class="input-group-text" for="rwSelect">RW</label>
        <select id="rwSelect" name="rw_id" class="form-select"
                onchange="if(this.value) location.href='/penduduk/'+this.value; else location.href='/penduduk'">
          <option value="">Semua RW</option>
          <% allRw.forEach(rw => { %>
            <option value="<%= rw.id %>"
              <%= rw_id && String(rw.id) === String(rw_id) ? 'selected' : '' %>>
              RW <%= rw.kode_rw %> - <%= rw.nama_rw %>
            </option>
          <% }) %>
        </select>
      </div>
    </form>

    <a href="/penduduk/<%= rw_id || '' %>/export/excel"
       class="btn btn-success btn-sm">Export Excel</a>

    <a href="/penduduk/add"
       class="btn btn-primary btn-sm">+ Tambah Penduduk</a>
  </div>
</div>

<table class="table table-striped table-bordered bg-white shadow-sm">
  <thead class="table-success">
    <tr>
      <th>
        <a href="?rt=<%= rt || '' %>&sort=rt&order=<%= sort==='rt' && order==='ASC' ? 'DESC':'ASC' %>">
          RT
          <% if (sort==='rt'){ %><%= order==='ASC'?'▲':'▼' %><% } %>
        </a>
      </th>      
      <th>Nama</th>
      <th>NIK</th>
      <th>JK</th>
      <th>Tanggal Lahir</th>
      <th>Pendidikan</th>
      <th>Pekerjaan</th>
      <th>Alamat</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody>
    <% if (penduduk.length) { %>
      <% penduduk.forEach(p => { %>
        <tr>
          <td><%= p.rt %></td>
          <td><%= p.nama %></td>
          <td><%= p.nik %></td>
          <td><%= p.jenis_kelamin %></td>
          <td><%= p.tanggal_lahir ? new Date(p.tanggal_lahir).toLocaleDateString('id-ID') : '' %></td>
          <td><%= p.pendidikan %></td>
          <td><%= p.pekerjaan %></td>
          <td><%= p.alamat %></td>
          <td>
            <a href="/penduduk/<%= rw_id || p.rw_id %>/<%= p.id %>/edit"
               class="btn btn-warning btn-sm">Edit</a>
            <form action="/penduduk/<%= rw_id || p.rw_id %>/<%= p.id %>/delete"
                  method="post" class="d-inline"
                  onsubmit="return confirm('Hapus data ini?');">
              <button class="btn btn-danger btn-sm">Hapus</button>
            </form>
          </td>          
        </tr>
      <% }) %>
    <% } else { %>
      <tr>
        <td colspan="9" class="text-center text-muted">Tidak ada data penduduk</td>
      </tr>
    <% } %>
  </tbody>
</table>
